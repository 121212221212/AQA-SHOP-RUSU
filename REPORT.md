# БАГ-РЕПОРТ #UI-001

## Основная информация
- **Название**: Неверное отображение статуса транзакции для карты 5555 6666 7777 8888
- **Серьезность**: Critical (Критический)
- **Приоритет**: High (Высокий)
- **Модуль**: UI уведомлений / Форма оплаты
- **Версия**: 1.0
- **Статус**: Open (Открыт)
- **Дата обнаружения**: 1.11.2025

## Описание
Система некорректно отображает уведомление для тестовой карты 5555 6666 7777 8888.
Вместо сообщения об ошибке "Ошибка! Банк отказал в проведении операции."
отображается сообщение об успехе "Операция одобрена Банком."

## Тестовые данные
| Карта               | Ожидаемый UI | Фактический UI | Статус в БД | Корректность |
|---------------------|--------------|----------------|-------------|--------------|
| 1111 2222 3333 4444 | "Одобрено"   | "Одобрено"     | APPROVED    | Да           |
| 5555 6666 7777 8888 | "Отклонено"  | "Одобрено"     | DECLINED    | Нет (БАГ)    |
| 9999 8888 7777 6666 | "Отклонено"  | "Отклонено"    | DECLINED    | Да           |

## Шаги для воспроизведения
1. Открыть приложение: http://localhost:8080
2. Выбрать "Купить" или "Купить в кредит"
3. Заполнить форму:
    - Номер карты: 5555 6666 7777 8888
    - Месяц: 12
    - Год: 25
    - Владелец: IVAN IVANOV
    - CVC: 123
4. Нажать "Продолжить"

## Ожидаемый результат
- UI: "Ошибка! Банк отказал в проведении операции."
- БД: статус транзакции "DECLINED"

## Фактический результат
- UI: "Операция одобрена Банком." 
- БД: статус транзакции "DECLINED" 

## Доказательства корректной работы бизнес-логики
### Результаты тестирования работы с базой данных

#### 1. Проверка корректности операций:

Все тестовые сценарии выполнены успешно. В базе данных зафиксированы 4 операции:

| № | Тип операции     | Статус   | Использованная карта    | Сумма      | Время выполнения       |
|---|------------------|----------|-------------------------|------------|------------------------|
| 1 | Обычная оплата   | DECLINED | 5555 6666 7777 8888     | 4 500 000  | 2025-12-02 14:17:31    |
| 2 | Обычная оплата   | APPROVED | 1111 2222 3333 4444     | 4 500 000  | 2025-12-02 14:16:58    |
| 3 | Оплата в кредит  | APPROVED | 1111 2222 3333 4444     | ---        | 2025-12-02 14:16:21    |
| 4 | Оплата в кредит  | DECLINED | 5555 6666 7777 8888     | ---        | 2025-12-02 14:16:07    |

#### 2. Соответствие тестовым данным:
-  Карта `1111 2222 3333 4444` всегда возвращает статус `APPROVED`
-  Карта `5555 6666 7777 8888` всегда возвращает статус `DECLINED`
-  Система корректно обрабатывает как обычные платежи, так и кредитные операции

#### 3. Структура базы данных:
После исправления некорректных связей база данных имеет правильную структуру:
- **`order_entity`** (4 записи) - содержит заказы
- **`payment_entity`** (2 записи) - содержит обычные платежи
- **`credit_request_entity`** (2 записи) - содержит кредитные операции

#### 4. SQL-запросы для проверки:
```sql
-- Проверка всех операций
SELECT 
    o.id as order_id,
    CASE 
        WHEN o.payment_id IS NOT NULL THEN 'Обычная оплата'
        WHEN o.credit_id IS NOT NULL THEN 'Оплата в кредит'
    END as operation_type,
    COALESCE(p.status, c.status) as status,
    p.amount as amount,
    o.created as created
FROM order_entity o
LEFT JOIN payment_entity p ON o.payment_id = p.transaction_id
LEFT JOIN credit_request_entity c ON o.credit_id = c.bank_id
ORDER BY o.created DESC;

-- Проверка количества операций
SELECT 
    'Всего операций' as metric, COUNT(*) as value FROM order_entity
UNION ALL
SELECT 'Обычные платежи', COUNT(*) FROM order_entity WHERE payment_id IS NOT NULL
UNION ALL
SELECT 'Кредитные платежи', COUNT(*) FROM order_entity WHERE credit_id IS NOT NULL;
```

## Окружение
- ОС: Windows 10 pro
- Браузер: Chrome 142 
- Java: 11-17
- Selenium: 4.11.0 
- БД: MySQL 8.0 / H2